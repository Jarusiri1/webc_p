@page 
@model MyWebApp.Pages.GroupModel
@{
    ViewData["Title"] = "จัดกลุ่มผู้ใช้งาน";
}

@if (TempData["SuccessMessage"] != null)
{
    <div class="alert alert-success">@TempData["SuccessMessage"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<h2>กลุ่มผู้ใช้งาน</h2>

<form method="get" class="row mb-3">
    <div class="col-md-4">
        <select name="applicationId" class="form-select" onchange="this.form.submit()">
            <option value="">ทุกแอปพลิเคชัน</option>
            @foreach (var app in Model.Applications)
            {
                <option value="@app.ApplicationId" selected="@(Model.SelectedApplicationId == app.ApplicationId)">
                    @app.ApplicationName
                </option>
            }
        </select>
    </div>
    <div class="col-md-8 text-end">
        <button type="button" class="btn btn-success" data-bs-toggle="modal" data-bs-target="#addGroupModal">+ เพิ่มกลุ่ม</button>
    </div>
</form>

<table class="table table-bordered">
    <thead class="table-light">
        <tr>
            <th>ชื่อกลุ่ม</th>
            <th>แอปพลิเคชัน</th>
            <th>คำอธิบาย</th>
            <th style="width:180px">จัดการ</th>
        </tr>
    </thead>
    <tbody>
    @foreach (var g in Model.Groups)
    {
        <tr>
            <td>@g.GroupName</td>
            <td>@g.Application?.ApplicationName</td>
            <td>@g.Description</td>
            <td>
                <button class="btn btn-sm btn-warning edit-btn"
                        data-id="@g.GroupId"
                        data-name="@g.GroupName"
                        data-app="@g.ApplicationId"
                        data-desc="@g.Description">แก้ไข</button>
                <button class="btn btn-sm btn-danger" onclick="openDelete('@g.GroupId','@g.GroupName')">ลบ</button>
            </td>
        </tr>
    }
    </tbody>
</table>

<!-- Add Modal -->
<div class="modal fade" id="addGroupModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="Create">
                <div class="modal-header"><h5>เพิ่มกลุ่ม</h5></div>
                <div class="modal-body">
                    <select asp-for="NewGroup.ApplicationId" class="form-select mb-2">
                        <option value="">-- เลือกแอป --</option>
                        @foreach (var app in Model.Applications)
                        {
                            <option value="@app.ApplicationId">@app.ApplicationName</option>
                        }
                    </select>
                    <span asp-validation-for="NewGroup.ApplicationId" class="text-danger"></span>

                    <input asp-for="NewGroup.GroupName" class="form-control mb-2" placeholder="ชื่อกลุ่ม" />
                    <span asp-validation-for="NewGroup.GroupName" class="text-danger"></span>

                    <textarea asp-for="NewGroup.Description" class="form-control" placeholder="คำอธิบาย"></textarea>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" type="submit">บันทึก</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit / Delete ใช้ JS -->

@section Scripts{
<script>
function openDelete(id,name){
    if(confirm('ลบกลุ่ม '+name+' ?')){
        $('<form>',{method:'post',action:'?handler=Delete'})
            .append($('<input>',{name:'DeleteId',value:id}))
            .appendTo(document.body).submit();
    }
}
$('.edit-btn').on('click',function(){
    $('#Edit_GroupId').val($(this).data('id'));
});
</script>
}
```

---

## Group.cshtml.cs

```csharp
using Microsoft.AspNetCore.Mvc;
using Microsoft.AspNetCore.Mvc.RazorPages;
using Microsoft.EntityFrameworkCore;
using MyWebApp.Data;
using MyWebApp.Models;
using System.ComponentModel.DataAnnotations;

namespace MyWebApp.Pages
{
    public class GroupModel : PageModel
    {
        private readonly AppDbContext _context;
        public GroupModel(AppDbContext context){_context=context;}

        public List<Group> Groups { get; set; } = new();
        public List<Application> Applications { get; set; } = new();
        public Guid? SelectedApplicationId { get; set; }

        [BindProperty] public GroupCreateModel NewGroup { get; set; } = new();
        [BindProperty] public Guid DeleteId { get; set; }

        public async Task OnGetAsync(Guid? applicationId)
        {
            await LoadDataAsync(applicationId);
        }

        public async Task<IActionResult> OnPostCreateAsync()
        {
            await LoadDataAsync(NewGroup.ApplicationId);
            if (!ModelState.IsValid)
            {
                return Page();
            }

            var exists = await _context.Groups.AnyAsync(g =>
                g.GroupName == NewGroup.GroupName && g.ApplicationId == NewGroup.ApplicationId);
            if (exists)
            {
                ModelState.AddModelError("NewGroup.GroupName","ชื่อกลุ่มซ้ำ");
                return Page();
            }

            _context.Groups.Add(new Group{
                GroupId = Guid.NewGuid(),
                ApplicationId = NewGroup.ApplicationId,
                GroupName = NewGroup.GroupName,
                Description = NewGroup.Description,
                CreateDate = DateTime.Now,
                UpdateDate = DateTime.Now,
                CreateBy = "System",
                UpdateBy = "System"
            });
            await _context.SaveChangesAsync();
            TempData["SuccessMessage"] = "เพิ่มกลุ่มสำเร็จ";
            return RedirectToPage(new{applicationId=NewGroup.ApplicationId});
        }

        public async Task<IActionResult> OnPostDeleteAsync()
        {
            var g = await _context.Groups.FindAsync(DeleteId);
            if (g!=null){_context.Groups.Remove(g);await _context.SaveChangesAsync();}
            TempData["SuccessMessage"] = "ลบกลุ่มสำเร็จ";
            return RedirectToPage();
        }

        private async Task LoadDataAsync(Guid? applicationId)
        {
            SelectedApplicationId = applicationId;
            Applications = await _context.Applications.OrderBy(a=>a.ApplicationName).ToListAsync();
            var q = _context.Groups.Include(g=>g.Application).AsQueryable();
            if(applicationId.HasValue) q=q.Where(g=>g.ApplicationId==applicationId);
            Groups = await q.OrderBy(g=>g.GroupName).ToListAsync();
        }
    }

    public class GroupCreateModel
    {
        [Required] public Guid ApplicationId { get; set; }
        [Required,StringLength(100)] public string GroupName { get; set; } = string.Empty;
        [StringLength(500)] public string? Description { get; set; }
    }
}
```
