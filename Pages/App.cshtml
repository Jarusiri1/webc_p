@page "/app"
@model MyWebApp.Pages.AppModel

@{
    ViewData["Title"] = "แอปพลิเคชัน";
}

@if (TempData["LoginMessage"] != null)
{
    <div class="alert alert-success">@TempData["LoginMessage"]</div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<h2 class="mb-3">แอปพลิเคชัน</h2>

<!-- ปุ่มเพิ่ม -->
<button 
    class="btn btn-success mb-3 float-end" 
    data-bs-toggle="modal" 
    data-bs-target="#addAppModal">
    + เพิ่มแอปพลิเคชัน
</button>

<!-- ช่องค้นหา -->
<form class="d-flex justify-content-start mb-3" style="max-width: 300px;">
  <div class="input-group input-group-sm">
    <input id="searchInput" type="text" class="form-control" placeholder="ค้นหาแอป" />
    <span class="input-group-text">
      <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="gray" viewBox="0 0 16 16">
        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 
        1 0 0 0 1.415-1.415l-3.85-3.85zm-5.242 1.4a5.5 5.5 0 1 1 
        0-11 5.5 5.5 0 0 1 0 11z"/>
      </svg>
    </span>
  </div>
</form>

<!-- ตาราง -->
<table id="appTable" class="table table-striped table-bordered text-center" style="table-layout: fixed; width: 100%;">
  <colgroup>
    <col style="width: 60px;" />
    <col style="width: 120px;" />
    <col />
    <col style="width: 200px;" />
    <col style="width: 100px;" />
    <col style="width: 120px;" />
  </colgroup>

  <thead class="table-light">
      <tr>
          <th>ลำดับ</th>
          <th>ID</th>
          <th>ชื่อ</th>
          <th>คำอธิบาย</th>
          <th>สถานะ</th>
          <th>จัดการข้อมูล</th>
      </tr>
  </thead>

  <tbody>
  @{ int index = 1; }
  @foreach (var app in Model.Applications)
  {
      <tr>
          <td>@index</td>
          <td style="white-space: nowrap;">@app.ApplicationId.ToString().Substring(0, 10)</td>
          <td class="text-start text-truncate">@app.ApplicationName</td>
          <td class="text-start text-truncate">@((app.Description ?? "-"))</td>
          <td>
              @if (app.ApplicationStatus == "ใช้งาน")
              {
                  <span class="text-success">ใช้งาน</span>
              }
              else
              {
                  <span class="text-danger">ไม่ได้ใช้งาน</span>
              }
          </td>
          <td>
              <button 
                  class="btn btn-sm btn-warning me-1 edit-btn"
                  data-bs-toggle="modal"
                  data-bs-target="#editAppModal"
                  data-id="@app.ApplicationId"
                  data-applicationname="@app.ApplicationName"
                  data-status="@app.ApplicationStatus"
                  data-description="@app.Description"
                  data-contactname="@app.ContactName"
                  data-telephone="@app.Telephone">
                  แก้ไข
              </button>

              <button 
                  class="btn btn-sm btn-danger"
                  data-bs-toggle="modal"
                  data-bs-target="#deleteAppModal"
                  onclick="fillDeleteModal('@app.ApplicationId', '@app.ApplicationName')">
                  ลบ
              </button>
          </td>
      </tr>
      index++;
  }
  </tbody>
</table>
